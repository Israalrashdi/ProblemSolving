CREATE DATABASE TMS;
USE TMS;

CREATE TABLE STUDENT(
St_ID INT(6) PRIMARY KEY ,
St_Major VARCHAR(30),
St_Cohort INT(4) NOT NULL
);

CREATE TABLE EMPLOYEE(
Em_ID INT(6) PRIMARY KEY ,
Em_Office VARCHAR(4) NOT NULL,
Em_Ext INT(4) CHECK (Em_Ext>1000)
);

CREATE TABLE COLLEGE(
CI_Code VARCHAR(3) PRIMARY KEY ,
CI_Name VARCHAR(40) NOT NULL,
CI_Dean VARCHAR(30)
);

CREATE TABLE DEPARTMENT(
Dp_Code VARCHAR(4) PRIMARY KEY ,
Dp_Name VARCHAR(40) NOT NULL,
Dp_HoD VARCHAR(30),
Dp_Col VARCHAR(3),
CI_Code VARCHAR (3),
FOREIGN KEY (CI_Code) REFERENCES COLLEGE (CI_Code)
);

CREATE TABLE BORROWER(
Br_ID INT(4) PRIMARY KEY ,
Br_name VARCHAR(30) NOT NULL,
Br_Dept VARCHAR(4),
Br_Mobile VARCHAR(8) CHECK (Br_Mobile>90000000),
Br_City VARCHAR(20),
Br_House VARCHAR(4),
Br_Type VARCHAR(1) CHECK (Br_Type IN ('S','E')),
FOREIGN KEY (Dp_Code) REFERENCES DEPARTMENT (Dp_Code)
);

CREATE TABLE BOOK(
Bk_ID INT(6) PRIMARY KEY ,
Bk_Title VARCHAR(50) NOT NULL,
Bk_Edition INT(2),
Bk_ofPages INT(2) CHECK (Bk_ofPages>0),
Bk_TotalCopies INT(5),
Bk_RemCopies INT(4),
Br_Type VARCHAR(5)
);

CREATE TABLE BOOKTOPIC(
Tp_BkID INT(6) PRIMARY KEY ,
Tp_Desc VARCHAR(30) NOT NULL,
FOREIGN KEY (Tp_BkID) REFERENCES BOOK (Tp_BkID)
);

CREATE TABLE COURSE(
Cr_Code VARCHAR(8) PRIMARY KEY ,
Cr_Title VARCHAR(40) NOT NULL,
Cr_CH INT(2) CHECK (Cr_CH>0),
Cr_ofSec INT(2)CHECK (Cr_CH>0),
Cr_Dept VARCHAR(4),
FOREIGN KEY (Cr_Dept) REFERENCES DEPARTMENT (Cr_Dept)
);

CREATE TABLE LINK(
Li_CrCode VARCHAR(8) PRIMARY KEY ,
Li_BkID INT(6),
Li_Usage VARCHAR(1) CHECK (Br_Type IN ('T','R')),
FOREIGN KEY (Li_CrCode) REFERENCES COURSE (Li_CrCode),
FOREIGN KEY (Li_BkID) REFERENCES BOOK (Li_BkID)
);


CREATE TABLE REGISTRATION(
Re_BrID INT(6),
Re_CrCode VARCHAR(8),
re_Semester VARCHAR(6) NOT NULL,
FOREIGN KEY (Re_BrID) REFERENCES BORROWER (Re_BrID),
FOREIGN KEY (Re_CrCode) REFERENCES COURSE (Re_CrCode)
);


CREATE TABLE ISSUING(
Is_BrID INT(6),
Is_BkID INT(6),
Is_DateTaken DATE NOT NULL,
Is_DateReturn DATE CHECK (Is_DateReturn >Is_DateTaken ),
FOREIGN KEY (Is_BrID) REFERENCES BORROWER (Is_BrID),
FOREIGN KEY (Is_BkID) REFERENCES BOOK (Is_BkID)
);

INSERT INTO college VALUES('COM', 'Economy', 'Prof. Fahim');

INSERT INTO college VALUES('SCI', 'Science', 'Prof. Salma');

INSERT INTO college VALUES('EDU', 'Education', 'Dr. Hamad');

INSERT INTO college VALUES('ART', 'Arts', 'Dr. Abdullah');



INSERT INTO department VALUES('INFS','Information Systems','Dr. Kamla','COM');

INSERT INTO department VALUES('FINA','Finance','Dr. Salim','COM');

INSERT INTO department VALUES('COMP','Computer Science','Dr. Zuhoor','SCI');

INSERT INTO department VALUES('BIOL','Biology','Dr. Othman','SCI');

INSERT INTO department VALUES('HIST','History','Dr. Said','EDU');

INSERT INTO department VALUES('CHEM', 'Chemistry', 'Dr. Alaa', 'SCI');



INSERT INTO borrower VALUES (92120,'Ali','INFS',99221133,'Seeb','231','S');

INSERT INTO borrower VALUES (10021,'Said','INFS',91212129,'Seeb','100','S');

INSERT INTO borrower VALUES (10023,'Muna','FINA', NULL, 'Barka','12','S');

INSERT INTO borrower VALUES (3000,'Mohammed','COMP',90000009,'Seeb','777','E');

INSERT INTO borrower VALUES (4000,'Nasser','INFS',99100199,'Sur','11','E');



INSERT INTO student VALUES(92120,'INFS',2012);

INSERT INTO student VALUES(10021,'INFS',2015);

INSERT INTO student VALUES(10023,'FINA',2015);



INSERT INTO employee VALUES(3000,'12',2221);

INSERT INTO employee VALUES(4000,'15',1401);



INSERT INTO book VALUES(1001,'Database1',2,450,150,65);

INSERT INTO book VALUES(1002,'Database2',3,300,100,100);

INSERT INTO book VALUES(2001,'Intro. to Finanace',1,300,75,40);

INSERT INTO book VALUES(3001,'Basic Op Mgmt',1,320,100,77);

INSERT INTO book VALUES(3002,'Chemistry Book',2,500,100,80);

INSERT INTO book VALUES(4001,'Biology',1,345,100,100);

INSERT INTO book VALUES(3003,'Management I',2,560,44,34);

INSERT INTO book VALUES(1003,'Java Prog.',3,555,50,50);



INSERT INTO bookTopic VALUES (1001,'Basic DB Skills');

INSERT INTO bookTopic VALUES (1001,'ERD');

INSERT INTO bookTopic VALUES (1001,'EERD');

INSERT INTO bookTopic VALUES (1002,'SQL');

INSERT INTO bookTopic VALUES (1002,'Pl/SQL');

INSERT INTO bookTopic VALUES (3001,'Management Skills');



INSERT INTO course VALUES('COMP4201', 'Database1', 3, 1,'COMP');

INSERT INTO course VALUES('COMP4202', 'Database2', 3, 2,'COMP');

INSERT INTO course VALUES('BIOL1000', 'Intro. To Biology', 3, 5,'BIOL');

INSERT INTO course VALUES('CHEM2000', 'Advanced Chemistry', 2, 2,'CHEM');



INSERT INTO CBlink VALUES('COMP4201',1001,'T');

INSERT INTO CBlink VALUES('COMP4201',1002,'R');

INSERT INTO CBlink VALUES('COMP4202',1002,'T');

INSERT INTO CBlink VALUES('BIOL1000',4001,'T');

INSERT INTO CBlink VALUES('CHEM2000',3002,'R');



INSERT INTO regist VALUES(92120,'COMP4201','FL2015');

INSERT INTO regist VALUES(10021,'COMP4202','FL2015');

INSERT INTO regist VALUES(92120,'BIOL1000','FL2015');

INSERT INTO regist VALUES(92120,'COMP4202','FL2016');

INSERT INTO regist VALUES(10021,'CHEM2000','FL2016');



INSERT INTO issuing VALUES(92120, 1001, '01-Sep-2015', '30-Oct-2015');

INSERT INTO issuing VALUES(10021, 1002, '30-Oct-2016', NULL);

INSERT INTO issuing VALUES(92120, 1002, '21-Feb-2015', '01-Jan-2016');

INSERT INTO issuing VALUES(92120, 3002, '30-Mar-2016', NULL);

INSERT INTO issuing VALUES(10021, 3002, '01-Dec-2014', NULL);



